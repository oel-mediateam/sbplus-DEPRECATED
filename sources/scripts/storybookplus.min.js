/* global console *//* global videojs *//* global MediaElementPlayer *//* global alert */$(document).load(function(){$("noscript").hide()});$(document).ready(function(){function _(e){var t=$(e).find("setup"),r=$(e).find("topic"),i=$(e).find("profile").text(),s=t.find("lesson").text().length<=0?"Lesson name is not specified":t.find("lesson").text(),o=t.find("instructor").text().length<=0?"Instructor is not specified":'<a class="instructorP" href="#profile">'+t.find("instructor").text()+"</a>",u=t.find("length").text().length<=0?"":t.find("length").text();C=t.find("note").text().length<=0?!1:t.find("note").text();C==="yes"||C==="y"?C=!0:C=!1;if(!C){$("#note").hide();$("#fontMinusBtn").hide();$("#fontPlusBtn").hide();$("#fontSizeIndicator").hide();$("#toc").css("height","399px")}x=t.find("slideImgFormat").text().length<=0?"png":t.find("slideImgFormat").text();E=$(e);$("#lessonTitle").html(s);$("#instructorName").html(o);$("#profile .bio").html("<p>"+t.find("instructor").text()+"</p>"+i);S=[];A=[];r.each(function(){var e=$(this).attr("title");S[v]=$(this).attr("src");if(d===!0){$("#selectable").html('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(v+1<10?"0"+(v+1):v+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");d=!1}else $("#selectable").append('<li class="ui-widget-content" title="'+e+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(v+1<10?"0"+(v+1):v+1)+'.</div><div class="title" style="width:86%;padding:0px 1%;float:left;">'+e+"</div></li>");if(S[v]==="quiz"){L={};L.id=v;L.type=E.find("topic:eq("+v+")").find("quiz").attr("type");L.question=E.find("topic:eq("+v+")").find("quiz").find("question").text();if(E.find("topic:eq("+v+")").find("quiz").find("choice").text()!==""){L.choice=D(E.find("topic:eq("+v+")").find("quiz").find("choice").text());L.wrongFeedback=D(E.find("topic:eq("+v+")").find("quiz").find("wrongFeedback").text())}else L.wrongFeedback=E.find("topic:eq("+v+")").find("quiz").find("wrongFeedback").text();L.answer=D(E.find("topic:eq("+v+")").find("quiz").find("answer").text());L.stuAnswer="";L.correct=!1;L.correctFeedback=E.find("topic:eq("+v+")").find("quiz").find("correctFeedback").text();L.taken=!1;A.push(L)}v++});$(document).attr("title",s);try{if(n){var a=window.location.href;a=a.replace("index.html","");window.history.pushState("","",a+"index.html")}}catch(f){console.log(f+" ---> No HTML history API support!")}$("#splash_screen").append("<p>"+s+"</p><p>"+(t.find("instructor").text().length<=0?"Instructor is not specified":t.find("instructor").text())+"</p>"+(u!==0?"<p>"+u+"</p>":"")+'<p><a id="playBtn" href="#">&#9658</button></a>');$("#splash_screen").css("background-image","url(assets/splash.jpg)");C||$("#splash_screen").css({height:"230px","padding-top":"100px","padding-bottom":"100px","padding-right":"200px","padding-left":"200px"});$("#splash_screen, #playBtn").on("click",function(){P(s);$("#splash_screen").hide();return!1});s=s.toLowerCase().replace("-","_").replace(/\s+/g,"");z(s,"mp3");z(s,"pdf")}function D(e){var t=0,n=[],r=e,i,s;r+="|";s=r.indexOf("|");while(r.indexOf("|")!==-1){i=r.substring(0,s);r=r.substring(s+1);s=r.indexOf("|");n[t]=i;t++}return n}function P(e){$("#player").show();H(S[0],m);$("#selectable li:first").addClass("ui-selected");$("#errorMsg").hide();$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){y=$("#selectable li").index(this)+1});if(y!==g){H(S[y-1],y);g=y}}});j();$("a#info, a.instructorP").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});if(C){$("#fontSizeIndicator").html(o);$("#fontMinusBtn").on("click",function(){o-=2;u-=2;a-=2;f-=2;l-=2;c-=2;h-=2;p-=2;if(o<=12){o=12;u=16}if(h<=16){h=16;p=20}if(l<=18){l=18;c=22}if(a<=20){a=20;f=24}$("#note, #note p").css({"font-size":o,"line-height":u+"px"});$("#note h1").css({"font-size":a,"line-height":c+"px"});$("#note h2").css({"font-size":l,"line-height":c+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":h,"line-height":p+"px"});$("#fontSizeIndicator").html(o)});$("#fontPlusBtn").on("click",function(){o+=2;u+=2;a+=2;f+=2;l+=2;c+=2;h+=2;p+=2;if(o>=28){o=28;u=32}if(h>=30){h=30;p=34}if(l>=32){l=32;c=36}if(a>=34){a=34;f=38}$("#note, #note p").css({"font-size":o,"line-height":u+"px"});$("#note h1").css({"font-size":a,"line-height":f+"px"});$("#note h2").css({"font-size":l,"line-height":c+"px"});$("#note h3, #note h4, #note h5, #note h6").css({"font-size":h,"line-height":p+"px"});$("#fontSizeIndicator").html(o)})}$("#leftBtn").on("click",function(){m--;m<=0&&(m=v);H(S[m-1],m)});$("#rightBtn").on("click",function(){m++;m>v&&(m=1);H(S[m-1],m)})}function H(e,t){var n,r,i;t=t<10?"0"+t:t;n=Number(t)-1;r=Number(t)-1;$("#slide").html('<div id="progressing"></div>');$("#progressing").fadeIn();if(w){$("#vp").html("");$("#vp").hide();w=!1}if(b){N.setCurrentTime(0);N.pause();b=!1;if(C){$("#ap").hide();$("#note").height($("#note").height()+30)}else{$("#apm").hide();$("#currentStatus").css("width","76.85%")}}if(e.substring(0,e.indexOf(":")+1)==="image:"){i=new Image;T="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+x;k=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+k+'"href="'+T+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});I(!0)}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+T+"</p><p>Total number of slides: "+v+"</p><p>"+e+"</p>")}).attr({src:T,border:0})}else if(e.substring(0,e.indexOf(":")+1)==="youtube:"){I(!1);$("#slide").append('<iframe width="640" height="360" src="https://www.youtube.com/embed/'+e.substring(e.indexOf(":")+1)+'?autoplay=1&rel=0" frameborder="0" allowfullscreen></iframe>')}else if(e.substring(0,e.indexOf(":")+1)==="video:"){I(!1);var s=$.now();$("#vp").append('<video id="vpc'+s+'" class="video-js vjs-default-skin" controls autoplay preload="none" width="640" height="360" data-setup=\'{"controls":true}\'><source type="video/mp4" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.mp4"'+' /><track kind="subtitles" src="assets/video/'+e.substring(e.indexOf(":")+1)+'.vtt" srclang="en" label="English" default></video>');if(!w){$("#vp").show();videojs("vpc"+s,{},function(){this.progressTips()});videojs.options.flash.swf="https://mediastreamer.doit.wisc.edu/uwli-ltc/sandbox/ethansandbox/StorybookPlus/version2/sources/videoplayer/video-js.swf";w=!0}}else if(e.substring(0,e.indexOf(":")+1)==="swf:"){I(!1);$("#slide").append('<object width="640" height="360" type="application/x-shockwave-flash" data="assets/swf/'+e.substring(e.indexOf(":")+1)+'.swf"><param name="movie" value="assets/swf/'+e+'.swf" /><p>Your web browser does not support Adobe Flash.</p></object>')}else if(e.substring(0,e.indexOf(":")+1)==="image-audio:"){i=new Image;T="assets/slides/"+e.substring(e.indexOf(":")+1)+"."+x;k=$("#selectable li .title").get(n).innerHTML;$(i).load(function(){$(this).hide();$("#slide").append('<a id="img" title="'+k+'"href="'+T+'">');$("#slide #img").html(i);$("#slide").append('</a><div id="magnifyIcon"></div>');C?$("#apc").html('<source type="audio/mpeg" src="assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /><object width="640" height="360" type="application/x-shockwave-flash" data="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/htmlPlayer/flashmediaelement.swf"><param name="movie" value="assets/htmlPlayer/flashmediaelement.swf" /><param name="flashvars" value="controls=true&file=assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /></object>'):$("#apcm").html('<source type="audio/mpeg" src="assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /><object width="640" height="360" type="application/x-shockwave-flash" data="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/htmlPlayer/flashmediaelement.swf"><param name="movie" value="assets/htmlPlayer/flashmediaelement.swf" /><param name="flashvars" value="controls=true&file=assets/audio/'+e.substring(e.indexOf(":")+1)+'.mp3" /></object>');$(this).fadeIn();$("a#img").fancybox({helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0});I(!0);if(!b){if(C){$("#ap").show();N=new MediaElementPlayer("#apc",{audioWidth:640,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0});$("#note").height($("#note").height()-30)}else{$("#apm").show();N=new MediaElementPlayer("#apcm",{audioWidth:300,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,pauseOtherPlayers:!0});$("#currentStatus").css("width","30%")}N.play();b=!0}}).error(function(e){$("#slide").html("<p><strong>Error</strong>: image not found. Image path: "+T+"</p><p>"+e+"</p>")}).attr({src:T,border:0})}else if(e==="quiz")try{q(n)}catch(o){console.append("<li>"+o+"</li>")}else $("#slide").html("<p>ERROR!</p>");B(r);F(t);$("#progressing").hide()}function B(e){var t=E.find("topic:eq("+e+")").find("note").text();$("#note").html(t)}function j(){var e=new Image,t="assets/pic.jpg";$(e).load(function(){$("#profile .photo").html('<img src="'+t+'" alt="Instructor Photo" border="0" />')}).error(function(){$("#profile .photo").html('<img src="assets/img/profile.png" width="200" height="300" alt="No Profile Photo" border="0" />')}).attr({src:t,border:0})}function F(e){m=e;$("#selectable li").each(function(){$(this).removeClass("ui-selected")});$("#selectable li:nth-child("+Number(e)+")").addClass("ui-selected");$("#currentStatus").html("Slide "+e+" of "+(v<10?"0"+v:v))}function I(e){if(e){$("a#img, #magnifyIcon").on("mouseenter",function(){$("#magnifyIcon").show()});$("a#img, #magnifyIcon").on("mouseleave",function(){$("#magnifyIcon").hide()});$("#magnifyIcon").on("click",function(){$.fancybox.open({href:T,title:k,helpers:{overlay:{css:{background:"rgba(250, 250, 250, 0.85)"}}},padding:0})})}}function q(e){while(!O||M===A.length)A[M].id===e?O=!0:M++;$("#slide").append('<div id="quiz"><div class="header">Quiz '+(M+1)+" of "+A.length+"</div>");$("#quiz").hide();$("#quiz").fadeIn();if(!A[M].taken){$("#quiz").append('<div class="question">'+A[M].question+"</div>");if(A[M].type==="t/f")$("#quiz").append('<div class="answerArea"><label for="t"><input id="t" type="radio" name="tf" value="true" /> True</label><label for="f"><input type="radio" id="f" name="tf" value="false" /> False</label></div>');else if(A[M].type==="fib")$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>');else if(A[M].type==="mc"){$("#quiz").append('<div class="answerArea">');for(var t=0;t<A[M].choice.length;t++)$(".answerArea").append('<label for="'+t+'"><input id="'+t+'" type="radio" name="mc" value="'+A[M].choice[t]+'" /> '+A[M].choice[t]+"</label>");$("#quiz").append("</div>")}else A[M].type==="sa"?$("#quiz").append('<div class="answerArea"><textarea id="saAns"></textArea></div>'):$("#quiz").append('<div class="answerArea">ERROR!</div>');$("#quiz").append('<div class="submitArea"><button id="check" rel="'+M+'">SUBMIT</button></div>');$("#check").click(function(){var e=Number($(this).attr("rel")),t;if(A[e].type==="t/f"){t=$("input:radio[name=tf]:checked").val();t===undefined&&(t="")}else if(A[e].type==="fib")t=$.trim($("#saAns").val());else if(A[e].type==="mc"){t=$("input:radio[name=mc]:checked").val();A[e].incorrectIndex=$("input:radio[name=mc]").index($("input:radio[name=mc]").filter(":checked"));t===undefined&&(t="")}else A[e].type==="sa"?t=$.trim($("#saAns").val()):$.trim(t);if(t!==""){for(var n=0;n<A[e].answer.length;n++)if(A[e].type==="fib"){var r=0;for(r;r<A[e].answer.length;r++)if(t.toLowerCase()===A[e].answer[r].toLowerCase()){A[e].correct=!0;break}}else A[e].type==="t/f"?t.toLowerCase()===A[e].answer[n].toLowerCase()?A[e].correct=!0:A[e].correct=!1:A[e].type==="mc"&&(t.toLowerCase()===A[e].answer[n].toLowerCase()?A[e].correct=!0:A[e].correct=!1);A[e].stuAnswer=t;A[e].taken=!0;R(e)}else alert("Please answer the question before submitting.")})}else R(M);$("#slide").append("</div>");M=0;O=!1}function R(e){var t="";$("#slide").html('<div id="quiz"><div class="header">Quiz '+(e+1)+" of "+A.length+" Feedback</div>");A[e].type!=="sa"&&(A[e].correct?$("#quiz").append('<p class="quizCorrect">Correct!</p>'):$("#quiz").append('<p class="quizIncorrect">Incorrect!</p>'));$("#quiz").append('<div class="question">'+A[e].question+"</div>");$("#quiz").append('<div class="feedback"><p><strong>Your anwser</strong>: '+A[e].stuAnswer+"</p>");for(var n=0;n<A[e].answer.length;n++)n===A[e].answer.length-1?t+=A[e].answer[n]:t+=A[e].answer[n]+", ";$(".feedback").append("<p><strong>Correct anwser</strong>: "+t+"</p></div>");if(A[e].type!=="sa")if(A[e].correct)$(".feedback").append("<p><strong>Feedback:</strong> "+A[e].correctFeedback+"</p>");else if(A[e].type==="mc"){var r=A[e].wrongFeedback[A[e].incorrectIndex];typeof r=="undefined"&&(r="");$(".feedback").append("<p><strong>Feedback:</strong> "+r+"</p>")}else $(".feedback").append("<p><strong>Feedback:</strong> "+A[e].wrongFeedback+"</p>")}function U(e,t){var n,r;e===0?n="<strong>Error 0</strong> - Not connect. Please verify network.":e===404?n="<strong>Error 404</strong> - Requested page not found.":e===406?n="<strong>Error 406</strong> - Not acceptable error.":e===500?n="<strong>Error 500</strong> - Internal Server Error.":n="Unknow error";t==="parsererror"?r="Requested XML parse failed.":t==="timeout"?r="Time out error.":t==="abort"?r="Ajax request aborted.":t==="error"?r="HTTP / URL Error (most likely a 404 or 406).":r="Uncaught Error.\n"+e.responseText;$("#player").hide();$("#errorMsg").html("<p>"+n+"<br />"+r+"</p>")}function z(e,t){var n;t==="pdf"?n="application/pdf":n="audio/mpeg";$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:n,async:!1,beforeSend:function(e){e.overrideMimeType(n);e.setRequestHeader("Accept",n)},success:function(){var n=e,r=$("#download_bar ul"),i=window.location.protocol;if(i!=="http:"){var s=window.location.href;s=s.substr(0,s.lastIndexOf("/")+1).replace("https","http");n=s+e}t==="pdf"?r.append('<li><a href="'+n+"."+t+'" target="_blank">Transcript</a></li>'):t==="mp3"&&r.append('<li><a href="'+n+"."+t+'" target="_blank">MP3</a></li>')},error:function(){var e;t==="pdf"?e="Transcript":t==="mp3"&&(e="MP3");e+=" pending...";$("#download_bar ul").before("<p>"+e+"</p>")}})}function W(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}var e=navigator.userAgent,t={iphone:e.match(/(iPhone|iPod|iPad)/),blackberry:e.match(/BlackBerry/),android:e.match(/Android/)},n=W("m")==="0"?!1:!0;if((t.iphone||t.ipod||t.ipad||t.blackberry||t.android)&&n){var r=window.location.href,i,s=r.indexOf(".");i=r.substr(s);r="http://webstreamer"+i+"?m=0";$("#player").hide();$("body").html('<div style="text-align:center; width:450px; height:315px;"><a href="'+r+'" target="_blank"><img src="https://mediastreamer.doit.wisc.edu/uwli-ltc/media/storybook_plus/img/view_on_full_site.png" width="450px" height="315px" alt="Launch Presentation in New Window" border="0" /></a></div>')}else{var o=14,u=18,a=22,f=26,l=20,c=24,h=18,p=22,d=!0,v=0,m=1,g=0,y=0,b=!1,w=!1,E,S,x,T,N,C=!1,k,L,A,O=!1,M=0;$.ajaxSetup({url:"assets/topic.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1});$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8");e.setRequestHeader("Accept","text/xml")},success:function(e){_(e)},error:function(e,t){U(e.status,t)}})}});